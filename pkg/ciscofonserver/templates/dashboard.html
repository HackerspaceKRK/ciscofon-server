
<!DOCTYPE html>
<html>
<head>
<title>Ciscofon Server Dashboard</title>
<style>
  body {
    font-family: sans-serif;
  }
  #log {
    font-family: monospace;
    white-space: pre;
  }
</style>
</head>
<body>
<h1>Ciscofon Server Dashboard</h1>

<fieldset>
  <legend>Live request logs</legend>
  <div id="log"></div>
</fieldset>

<script>
  const log = document.getElementById('log');

  function addLogEntry(data) {
    const entry = document.createElement('div');
    entry.textContent = `[${data.time}] [${data.service}] ${data.ip} ${data.method} ${data.path} ${data.status}`;
    log.appendChild(entry);
  }

  fetch('/dashboard/api/logs-buffer')
    .then(response => response.json())
    .then(data => {
      data.forEach(addLogEntry);
    });

  const ws = new WebSocket(`ws://${window.location.host}/dashboard/log-ws`);
  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    addLogEntry(data);
  };
</script>
</body>
</html>
